<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>kprocess.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.18 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="pages.html">Related Pages</a> &nbsp; </center>
<hr><h1>kprocess.h</h1><div class="fragment"><pre>00001 <span class="comment">/* This file is part of the KDE libraries</span>
00002 <span class="comment">    Copyright (C) 1997 Christian Czezakte (e9025461@student.tuwien.ac.at)</span>
00003 <span class="comment"></span>
00004 <span class="comment">    This library is free software; you can redistribute it and/or</span>
00005 <span class="comment">    modify it under the terms of the GNU Library General Public</span>
00006 <span class="comment">    License as published by the Free Software Foundation; either</span>
00007 <span class="comment">    version 2 of the License, or (at your option) any later version.</span>
00008 <span class="comment"></span>
00009 <span class="comment">    This library is distributed in the hope that it will be useful,</span>
00010 <span class="comment">    but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
00011 <span class="comment">    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</span>
00012 <span class="comment">    Library General Public License for more details.</span>
00013 <span class="comment"></span>
00014 <span class="comment">    You should have received a copy of the GNU Library General Public License</span>
00015 <span class="comment">    along with this library; see the file COPYING.LIB.  If not, write to</span>
00016 <span class="comment">    the Free Software Foundation, Inc., 59 Temple Place - Suite 330,</span>
00017 <span class="comment">    Boston, MA 02111-1307, USA.</span>
00018 <span class="comment">*/</span>
00019 <span class="comment">//</span>
00020 <span class="comment">//  KPROCESS -- A class for handling child processes in KDE without</span>
00021 <span class="comment">//  having to take care of Un*x specific implementation details</span>
00022 <span class="comment">//</span>
00023 <span class="comment">//  version 0.3.1, Jan 8th 1998</span>
00024 <span class="comment">//</span>
00025 <span class="comment">//  (C) Christian Czezatke</span>
00026 <span class="comment">//  e9025461@student.tuwien.ac.at</span>
00027 <span class="comment">//</span>
00028 
00029 <span class="preprocessor">#ifndef __kprocess_h__</span>
00030 <span class="preprocessor"></span><span class="preprocessor">#define __kprocess_h__</span>
00031 <span class="preprocessor"></span>
00032 <span class="preprocessor">#include &lt;sys/types.h&gt;</span> <span class="comment">// for pid_t</span>
00033 <span class="preprocessor">#include &lt;sys/wait.h&gt;</span>
00034 <span class="preprocessor">#include &lt;signal.h&gt;</span>
00035 <span class="preprocessor">#include &lt;unistd.h&gt;</span>
00036 <span class="preprocessor">#include &lt;qvaluelist.h&gt;</span>
00037 <span class="preprocessor">#include &lt;qcstring.h&gt;</span>
00038 <span class="preprocessor">#include &lt;qobject.h&gt;</span>
00039 
00040 <span class="keyword">class </span>QSocketNotifier;
00041 <span class="keyword">class </span>KProcessPrivate;
00042 
<a name="l00146"></a><a class="code" href="classKProcess.html">00146</a> <span class="keyword">class </span><a class="code" href="classKProcess.html">KProcess</a> : <span class="keyword">public</span> QObject
00147 {
00148   Q_OBJECT
00149 
00150 <span class="keyword">public</span>:
00151 
<a name="l00164"></a><a class="code" href="classKProcess.html#s10">00164</a>   <span class="keyword">enum</span> <a class="code" href="classKProcess.html#s10">Communication</a> { NoCommunication = 0, Stdin = 1, Stdout = 2, Stderr = 4,
00165                        AllOutput = 6, All = 7,
00166                        NoRead };
00167 
<a name="l00171"></a><a class="code" href="classKProcess.html#s11">00171</a>   <span class="keyword">enum</span> <a class="code" href="classKProcess.html#s11">RunMode</a> {
00176        <a class="code" href="classKProcess.html#s11s7">DontCare</a>,
00180        <a class="code" href="classKProcess.html#s11s8">NotifyOnExit</a>,
00184        <a class="code" href="classKProcess.html#s11s9">Block</a> };
00185 
00189   <a class="code" href="classKProcess.html#a0">KProcess</a>();
00190 
00199   <span class="keyword">virtual</span> <a class="code" href="classKProcess.html#a1">~KProcess</a>();
00200 
00214   <span class="keywordtype">bool</span> <a class="code" href="classKProcess.html#a2">setExecutable</a>(<span class="keyword">const</span> QString&amp; proc);
00215 
00216 
00228   <a class="code" href="classKProcess.html">KProcess</a> &amp;<a class="code" href="classKProcess.html#a3">operator&lt;&lt;</a>(<span class="keyword">const</span> QString&amp; arg);
00232   <a class="code" href="classKProcess.html">KProcess</a> &amp;<a class="code" href="classKProcess.html#a3">operator&lt;&lt;</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> * arg);
00236   <a class="code" href="classKProcess.html">KProcess</a> &amp;<a class="code" href="classKProcess.html#a3">operator&lt;&lt;</a>(<span class="keyword">const</span> QCString &amp; arg);
00237 
00242   <a class="code" href="classKProcess.html">KProcess</a> &amp;<a class="code" href="classKProcess.html#a3">operator&lt;&lt;</a>(<span class="keyword">const</span> QStringList&amp; <a class="code" href="classKProcess.html#a21">args</a>);
00243 
00248   <span class="keywordtype">void</span> <a class="code" href="classKProcess.html#a7">clearArguments</a>();
00249 
00272   <span class="keyword">virtual</span> <span class="keywordtype">bool</span> <a class="code" href="classKProcess.html#a8">start</a>(<a class="code" href="classKProcess.html#s11">RunMode</a>  runmode = <a class="code" href="classKProcess.html#s11s8">NotifyOnExit</a>,
00273     <a class="code" href="classKProcess.html#s10">Communication</a> comm = NoCommunication);
00274 
00281   <span class="keyword">virtual</span> <span class="keywordtype">bool</span> <a class="code" href="classKProcess.html#a9">kill</a>(<span class="keywordtype">int</span> signo = SIGTERM);
00282 
00286   <span class="keywordtype">bool</span> <a class="code" href="classKProcess.html#a10">isRunning</a>() <span class="keyword">const</span>;
00287 
00297   pid_t <a class="code" href="classKProcess.html#a11">pid</a>() <span class="keyword">const</span>;
00298 
<a name="l00303"></a><a class="code" href="classKProcess.html#a12">00303</a>   pid_t <a class="code" href="classKProcess.html#a12">getPid</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="classKProcess.html#a11">pid</a>(); }
00304 
00308   <span class="keywordtype">void</span> <a class="code" href="classKProcess.html#a13">suspend</a>();
00309 
00313   <span class="keywordtype">void</span> <a class="code" href="classKProcess.html#a14">resume</a>();
00314 
00322   <span class="keywordtype">bool</span> <a class="code" href="classKProcess.html#a15">normalExit</a>() <span class="keyword">const</span>;
00323 
00333   <span class="keywordtype">int</span>  <a class="code" href="classKProcess.html#a16">exitStatus</a>() <span class="keyword">const</span>;
00334 
00335 
00360   <span class="keywordtype">bool</span> <a class="code" href="classKProcess.html#a17">writeStdin</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *buffer, <span class="keywordtype">int</span> buflen);
00361 
00369   <span class="keywordtype">bool</span> <a class="code" href="classKProcess.html#a18">closeStdin</a>();
00370 
00378   <span class="keywordtype">bool</span> <a class="code" href="classKProcess.html#a19">closeStdout</a>();
00379 
00387   <span class="keywordtype">bool</span> <a class="code" href="classKProcess.html#a20">closeStderr</a>();
00388 
<a name="l00393"></a><a class="code" href="classKProcess.html#a21">00393</a>   <span class="keyword">const</span> QValueList&lt;QCString&gt; &amp;<a class="code" href="classKProcess.html#a21">args</a>() { <span class="keywordflow">return</span> <a class="code" href="classKProcess.html#n0">arguments</a>; }
00394 
00401   <span class="keywordtype">void</span> <a class="code" href="classKProcess.html#a22">setRunPrivileged</a>(<span class="keywordtype">bool</span> keepPrivileges);
00402 
00407   <span class="keywordtype">bool</span> <a class="code" href="classKProcess.html#a23">runPrivileged</a>() <span class="keyword">const</span>;
00408   
00413   <span class="keywordtype">void</span> <a class="code" href="classKProcess.html#a24">setEnvironment</a>(<span class="keyword">const</span> QString &amp;name, <span class="keyword">const</span> QString &amp;value);
00414 
00420   <span class="keywordtype">void</span> <a class="code" href="classKProcess.html#a25">setWorkingDirectory</a>(<span class="keyword">const</span> QString &amp;dir);
00421 
00429   <span class="keywordtype">void</span> <a class="code" href="classKProcess.html#a26">detach</a>(); 
00430 
00431 signals:
00432 
00438   <span class="keywordtype">void</span> <a class="code" href="classKProcess.html#j0">processExited</a>(<a class="code" href="classKProcess.html">KProcess</a> *proc);
00439 
00440 
00455   <span class="keywordtype">void</span> <a class="code" href="classKProcess.html#j1">receivedStdout</a>(<a class="code" href="classKProcess.html">KProcess</a> *proc, <span class="keywordtype">char</span> *buffer, <span class="keywordtype">int</span> buflen);
00456 
00472   <span class="keywordtype">void</span> <a class="code" href="classKProcess.html#j1">receivedStdout</a>(<span class="keywordtype">int</span> fd, <span class="keywordtype">int</span> &amp;len);
00473 
00474 
00488   <span class="keywordtype">void</span> <a class="code" href="classKProcess.html#j3">receivedStderr</a>(<a class="code" href="classKProcess.html">KProcess</a> *proc, <span class="keywordtype">char</span> *buffer, <span class="keywordtype">int</span> buflen);
00489 
00495   <span class="keywordtype">void</span> <a class="code" href="classKProcess.html#j4">wroteStdin</a>(<a class="code" href="classKProcess.html">KProcess</a> *proc);
00496 
00497 
00498 <span class="keyword">protected</span> slots:
00499 
00504   <span class="keywordtype">void</span> <a class="code" href="classKProcess.html#h0">slotChildOutput</a>(<span class="keywordtype">int</span> fdno);
00505 
00510   <span class="keywordtype">void</span> <a class="code" href="classKProcess.html#h1">slotChildError</a>(<span class="keywordtype">int</span> fdno);
00511   <span class="comment">/*</span>
00512 <span class="comment">    Slot functions for capturing stdout and stderr of the child</span>
00513 <span class="comment">  */</span>
00514 
00520   <span class="keywordtype">void</span> <a class="code" href="classKProcess.html#h2">slotSendData</a>(<span class="keywordtype">int</span> dummy);
00521 
00522 <span class="keyword">protected</span>:
00523 
00528   <span class="keywordtype">void</span> <a class="code" href="classKProcess.html#b0">setupEnvironment</a>();
00529 
<a name="l00534"></a><a class="code" href="classKProcess.html#n0">00534</a>   QValueList&lt;QCString&gt; <a class="code" href="classKProcess.html#n0">arguments</a>;
<a name="l00539"></a><a class="code" href="classKProcess.html#n1">00539</a>   <a class="code" href="classKProcess.html#s11">RunMode</a> <a class="code" href="classKProcess.html#n1">run_mode</a>;
<a name="l00547"></a><a class="code" href="classKProcess.html#n2">00547</a>   <span class="keywordtype">bool</span> <a class="code" href="classKProcess.html#n2">runs</a>;
00548 
<a name="l00556"></a><a class="code" href="classKProcess.html#n3">00556</a>   pid_t <a class="code" href="classKProcess.html#n3">pid_</a>;
00557 
<a name="l00565"></a><a class="code" href="classKProcess.html#n4">00565</a>   <span class="keywordtype">int</span> <a class="code" href="classKProcess.html#n4">status</a>;
00566 
00567 
<a name="l00571"></a><a class="code" href="classKProcess.html#n5">00571</a>   <span class="keywordtype">bool</span> <a class="code" href="classKProcess.html#n5">keepPrivs</a>;
00572 
00573   <span class="comment">/*</span>
00574 <span class="comment">    Functions for setting up the sockets for communication.</span>
00575 <span class="comment">    setupCommunication</span>
00576 <span class="comment">    -- is called from "start" before "fork"ing.</span>
00577 <span class="comment">    commSetupDoneP</span>
00578 <span class="comment">    -- completes communication socket setup in the parent</span>
00579 <span class="comment">    commSetupDoneC</span>
00580 <span class="comment">    -- completes communication setup in the child process</span>
00581 <span class="comment">    commClose</span>
00582 <span class="comment">    -- frees all allocated communication resources in the parent</span>
00583 <span class="comment">    after the process has exited</span>
00584 <span class="comment">  */</span>
00585 
00599   <span class="keyword">virtual</span> <span class="keywordtype">int</span> <a class="code" href="classKProcess.html#b1">setupCommunication</a>(<a class="code" href="classKProcess.html#s10">Communication</a> comm);
00600 
00612   <span class="keyword">virtual</span> <span class="keywordtype">int</span> <a class="code" href="classKProcess.html#b2">commSetupDoneP</a>();
00613 
00620   <span class="keyword">virtual</span> <span class="keywordtype">int</span> <a class="code" href="classKProcess.html#b3">commSetupDoneC</a>();
00621 
00622 
00629   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classKProcess.html#b4">processHasExited</a>(<span class="keywordtype">int</span> state);
00630 
00635   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classKProcess.html#b5">commClose</a>();
00636 
00637 
<a name="l00641"></a><a class="code" href="classKProcess.html#n6">00641</a>   <span class="keywordtype">int</span> <a class="code" href="classKProcess.html#n6">out</a>[2];
00642   <span class="keywordtype">int</span> in[2];
00643   <span class="keywordtype">int</span> err[2];
00644 
<a name="l00648"></a><a class="code" href="classKProcess.html#n9">00648</a>   QSocketNotifier *<a class="code" href="classKProcess.html#n9">innot</a>;
00649   QSocketNotifier *outnot;
00650   QSocketNotifier *errnot;
00651 
<a name="l00656"></a><a class="code" href="classKProcess.html#n12">00656</a>   <a class="code" href="classKProcess.html#s10">Communication</a> <a class="code" href="classKProcess.html#n12">communication</a>;
00657 
00663   <span class="keywordtype">int</span> <a class="code" href="classKProcess.html#b6">childOutput</a>(<span class="keywordtype">int</span> fdno);
00664 
00670   <span class="keywordtype">int</span> <a class="code" href="classKProcess.html#b7">childError</a>(<span class="keywordtype">int</span> fdno);
00671 
00672   <span class="comment">// information about the data that has to be sent to the child:</span>
00673 
00674   <span class="keyword">const</span> <span class="keywordtype">char</span> *input_data;  <span class="comment">// the buffer holding the data</span>
00675   <span class="keywordtype">int</span> input_sent;    <span class="comment">// # of bytes already transmitted</span>
00676   <span class="keywordtype">int</span> input_total;   <span class="comment">// total length of input_data</span>
00677 
<a name="l00682"></a><a class="code" href="classKProcess.html#l0">00682</a>   <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="classKProcessController.html">KProcessController</a>;
00683 
00684 
00685 <span class="keyword">private</span>:
00686   <span class="comment">// Disallow assignment and copy-construction</span>
00687   <a class="code" href="classKProcess.html#a0">KProcess</a>( <span class="keyword">const</span> <a class="code" href="classKProcess.html">KProcess</a>&amp; );
00688   <a class="code" href="classKProcess.html">KProcess</a>&amp; operator= ( <span class="keyword">const</span> <a class="code" href="classKProcess.html">KProcess</a>&amp; );
00689 
00690 <span class="keyword">protected</span>:
00691   <span class="keyword">virtual</span> <span class="keywordtype">void</span> virtual_hook( <span class="keywordtype">int</span> id, <span class="keywordtype">void</span>* data );
00692 <span class="keyword">private</span>:
00693   KProcessPrivate *d;
00694 };
00695 
00696 <span class="keyword">class </span>KShellProcessPrivate;
00697 
<a name="l00727"></a><a class="code" href="classKShellProcess.html">00727</a> <span class="keyword">class </span><a class="code" href="classKShellProcess.html">KShellProcess</a>: <span class="keyword">public</span> <a class="code" href="classKProcess.html">KProcess</a>
00728 {
00729   Q_OBJECT
00730 
00731 <span class="keyword">public</span>:
00732 
00740   <a class="code" href="classKShellProcess.html#a0">KShellProcess</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *shellname=0);
00741 
00745   <a class="code" href="classKShellProcess.html#a1">~KShellProcess</a>();
00746 
00752   <span class="keyword">virtual</span> <span class="keywordtype">bool</span> <a class="code" href="classKShellProcess.html#a2">start</a>(<a class="code" href="classKProcess.html#s11">RunMode</a>  runmode = <a class="code" href="classKProcess.html#s11s8">NotifyOnExit</a>,
00753           <a class="code" href="classKProcess.html#s10">Communication</a> comm = NoCommunication);
00754 
00761   <span class="keyword">static</span> QString <a class="code" href="classKShellProcess.html#d0">quote</a>(<span class="keyword">const</span> QString &amp;arg);
00762 
00763 <span class="keyword">private</span>:
00764 
00769   QCString searchShell();
00770 
00775   <span class="keywordtype">bool</span> isExecutable(<span class="keyword">const</span> QCString &amp;filename);
00776 
00777   QCString shell;
00778 
00779   <span class="comment">// Disallow assignment and copy-construction</span>
00780   <a class="code" href="classKShellProcess.html#a0">KShellProcess</a>( <span class="keyword">const</span> <a class="code" href="classKShellProcess.html">KShellProcess</a>&amp; );
00781   <a class="code" href="classKShellProcess.html">KShellProcess</a>&amp; operator= ( <span class="keyword">const</span> <a class="code" href="classKShellProcess.html">KShellProcess</a>&amp; );
00782 
00783 <span class="keyword">protected</span>:
00784   <span class="keyword">virtual</span> <span class="keywordtype">void</span> virtual_hook( <span class="keywordtype">int</span> id, <span class="keywordtype">void</span>* data );
00785 <span class="keyword">private</span>:
00786   KShellProcessPrivate *d;
00787 };
00788 
00789 
00790 
00791 <span class="preprocessor">#endif</span>
00792 <span class="preprocessor"></span>
</pre></div><hr><address style="align: right;"><small>Generated on Sat Jul 26 04:23:40 2003 by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.18 </small></address>
</body>
</html>
